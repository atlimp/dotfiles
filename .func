#!/bin/bash

cd(){ builtin cd $@ && pwd && ls -l; }

tex() {
	document=${@%/}
	
	wmctrl -r :ACTIVE: -N "$document"

	# If new document create new
	if [ ! -d $document ]; then
			mkdir -p $document
			cp $HOME/.tex/example.tex "$document/$document.tex"
	fi

	builtin cd $document

	latexmk -pvc -pdf $document.tex > /dev/null 2>&1 &
	latexmkpid=$!

	# Wait for render of pdf
	while [ ! -f "$document.pdf" ]; do :; done

	zathura --fork "$document.pdf"
	zathurapid=$(ps aux | grep zathura | grep $document | awk '{print $2}')
	
	wmctrl -a "$document"

	vim "+32" "$document.tex"
	
	kill $latexmkpid $zathurapid

	builtin cd ..

	wmctrl -r :ACTIVE: -N "sakura"
}
